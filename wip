# ------- CELL 7: Write to Target (Delta Lake) --------

# Write the Final DataFrame to the Target Delta Table
# We use 'overwriteSchema' to ensure the table schema updates automatically 
# if we change logic in previous cells.

print(f"Writing data to target table: {params['target']} ...")

df_result.write \
    .format("delta") \
    .mode("overwrite") \
    .option("overwriteSchema", "true") \
    .saveAsTable(params["target"])

print(f"SUCCESS: Table '{params['target']}' created successfully.")

# Optional: Quick Validation
# count = spark.read.table(params["target"]).count()
# print(f"Total Records Processed: {count}")
