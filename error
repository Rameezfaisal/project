This step builds the R, S, C, X, D parts (non-standard parts) and:
keeps only those parts that belong to active engineering obsolescence projects (Confirmed, In-Work, or In-Review)
In business terms:
We are pulling all replacement, substitute, and cross-reference parts that are part of live obsolescence projects, along with their demand, stock, supplier, and manufacturer info.







CELL-7 ‚Äî UNION of OBPR ecosystem + RSCXD parts
üíº Business meaning
We now merge:
Primary OBPR parts (from the engineering obsolescence projects)
R / S / C / X / D parts (replacement, substitute, cross-reference parts)
This creates one complete ‚ÄúPart Ecosystem‚Äù that the business uses to:
see all parts related to an obsolescence project in one dataset.







# ---- Define final column list (SAP var_out structure) ----
cols = [
    "obprno","obprtno","nha","description","cmpqpa","level","matkl","mstae","part_status",
    "vencode","venname","mfg_5yrs_consumption","sprs_5yrs_consumption",
    "mfg_12mnths_consumption","mfg_dmd","sprs_dmd","lamqoh","open_po_qty",
    "std_cost","curr_cost","lead_time","mfr_part_id","name","reltd_ob_pr",
    "commodity","business_unit","pg_pm","smg_group","smg_head","sbm","critical","ce",
    "enditem","obprtflag","po_supplier_code","po_supplier",
    "pr_supplier_code","pr_supplier",
    "supplier_code_1900","supplier_name_1900",
    "supplier_code_2000","supplier_name_2000",
    "supplier_code_3120","supplier_name_3120",
    "supplier_code_1050","supplier_name_1050",
    "supplier_code_1060","supplier_name_1060",
    "supplier_code_1090","supplier_name_1090",
    "restricted_all_stock"
]

# ---- Align both sides ----
main_aligned = main_df.select(*[F.col(c) for c in cols])
rscxd_aligned = rscxd_final.select(*[F.col(c) for c in cols])

# ---- UNION ALL ----
final_df = main_aligned.unionByName(rscxd_aligned)
