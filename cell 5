CREATE TABLE IF NOT EXISTS eng_test.omat_dmd_consumption_dtls (
  cmpprtno                STRING,
  lamqoh                  INT,
  last_modified_on        DATE,
  mfg_12mnths_consumption INT,
  mfg_3yrs_consumption    INT,
  mfg_5yrs_consumption    INT,
  mfg_dmd                 INT,
  nha                     STRING,
  open_po_qty             INT,
  restricted_all_stock    INT,
  sprs_3yrs_consumption   INT,
  sprs_5yrs_consumption   INT,
  sprs_dmd                INT
)
USING DELTA;

The error indicates a column order mismatch between your DataFrame and the target table. The table expects columns in a different order. Here's the fix:
# ===== Step 11: Insert into Target Table =====

# IMPORTANT: Match the exact column order of the target table
final_ordered = final.select(
    "cmpprtno",
    "nha",
    "mfg_3yrs_consumption",
    "mfg_dmd",
    "sprs_dmd",
    "sprs_3yrs_consumption",
    "mfg_12mnths_consumption",
    "lamqoh",
    "restricted_all_stock",
    "open_po_qty",
    "last_modified_on",
    "mfg_5yrs_consumption",
    "sprs_5yrs_consumption"
)

# Option 1: Use SQL INSERT (explicit column mapping - SAFEST)
final_ordered.createOrReplaceTempView("final_dmd")

spark.sql(f"""
INSERT INTO {tgt_dmd} 
(cmpprtno, nha, mfg_3yrs_consumption, mfg_dmd, sprs_dmd, sprs_3yrs_consumption,
 mfg_12mnths_consumption, lamqoh, restricted_all_stock, open_po_qty, 
 last_modified_on, mfg_5yrs_consumption, sprs_5yrs_consumption)
SELECT 
 cmpprtno, nha, mfg_3yrs_consumption, mfg_dmd, sprs_dmd, sprs_3yrs_consumption,
 mfg_12mnths_consumption, lamqoh, restricted_all_stock, open_po_qty, 
 last_modified_on, mfg_5yrs_consumption, sprs_5yrs_consumption
FROM final_dmd
""")

print(f"âœ… Data inserted successfully")

# Option 2: If you want to use DataFrame.write, match column order exactly
# Get target table schema first
target_schema = spark.table(tgt_dmd).schema
# Then reorder your DataFrame to match
# final_ordered.write.mode("append").format("delta").saveAsTable(tgt_dmd)
Use Option 1 (SQL INSERT) - it's explicit about column mapping and safer. The error suggests the target table has columns in alphabetical order but you're providing them in a different order.
