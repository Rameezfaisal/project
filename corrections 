spark.sql("""
CREATE OR REPLACE TEMP VIEW obprlst AS
SELECT DISTINCT
       DENSE_RANK() OVER (ORDER BY a.NAME) AS id,
       a.NAME AS ob_prno
FROM (
    SELECT * FROM {tbl_iplm_prp}
) a
LEFT JOIN (
    SELECT * FROM {tbl_omat_obprt_src}
) b
  ON a.NAME = b.OBPRNO
 AND a.PART_NAME = b.OBPRTNO
WHERE a.PART_NAME <> 'NA'
  AND UPPER(a.STATE) <> 'CLOSED'
  AND (
        UPPER(a.STATE) IN ('CONFIRMED','IN REVIEW','IN WORK')
        OR UPPER(a.DISPOSITION) IN ('CONFIRMED','DEFER')
      )
  AND UPPER(a.REASON) = 'OBSOLETE COMPONENT'
  AND b.OBPRNO IS NULL
ORDER BY a.NAME
LIMIT {weekly_limit}
""".format(
    tbl_iplm_prp=tbl_iplm_prp,
    tbl_omat_obprt_src=tbl_omat_obprt_src,
    weekly_limit=weekly_limit
))