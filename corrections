CELL 10 — QOH (LAMQOH & Restricted Stock)


In business terms:
For every NHA, calculate:
LAMQOH → usable stock (free + quality inspection)
Restricted_All_Stock → blocked, in-transit, or restricted inventory
This tells the business how much inventory is really available vs demand.






qoh = (
    newlist
    .join(mard, newlist.odrbom == mard.matnr, "inner")
    .groupBy("nha")
    .agg(
        F.sum(F.col("labst") + F.col("klabs")).cast("int").alias("lamqoh"),
        F.sum(F.col("insme") + F.col("umlme") + F.col("einme") + F.col("speme")).cast("int").alias("restricted_all_stock")
    )
)