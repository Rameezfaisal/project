spark.sql(f"""
INSERT INTO {tbl_omat_obprt_tgt} (
    business_unit,
    created_on,
    duplicate_pr_flag,
    enditem,
    is_ltb_avail,
    is_obprt_processed,
    is_weekly_processed,
    last_modified_on,
    ltb_date,
    ltb_qty,
    obprno,
    obprtno,
    obpr_state,
    part_status,
    pg_pm,
    reltd_ob_pr,
    supplier_date_to_zero
)
SELECT
    CAST(NULL AS STRING)          AS business_unit,
    current_timestamp()          AS created_on,
    CASE
        WHEN r.reltd_ob_prs IS NOT NULL THEN 'Yes'
        ELSE 'No'
    END                           AS duplicate_pr_flag,
    CAST(NULL AS STRING)          AS enditem,
    d.is_ltb_avail_cd             AS is_ltb_avail,
    d.is_obprt_processed          AS is_obprt_processed,
    'A'                           AS is_weekly_processed,
    current_timestamp()          AS last_modified_on,
    d.ltb_date_cd                 AS ltb_date,
    d.ltb_qty                     AS ltb_qty,
    d.ob_prno                     AS obprno,
    d.ob_prtno                    AS obprtno,
    d.obpr_state_cd               AS obpr_state,
    d.part_status_cd              AS part_status,
    CAST(NULL AS STRING)          AS pg_pm,
    r.reltd_ob_prs                AS reltd_ob_pr,
    d.supplier_date_to_zero_cd    AS supplier_date_to_zero
FROM (
    SELECT
        ob_prno,
        ob_prtno,
        part_status_cd,
        obpr_state_cd,
        is_ltb_avail_cd,
        ltb_date_cd,
        ltb_qty,
        is_obprt_processed,
        supplier_date_to_zero_cd
    FROM obprdtls
    WHERE ob_prno IS NOT NULL      -- ðŸ”´ REQUIRED
      AND ob_prtno IS NOT NULL     -- ðŸ”´ REQUIRED
) d
LEFT JOIN related_prs r
  ON d.ob_prno  = r.ob_prno
 AND d.ob_prtno = r.ob_prtno
""")