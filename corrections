Cell 5: Apply SAP date-driven row filtering
Business meaning:
SAP does not process all rows every run.
It filters PRST rows based on the Date Flag (IP_DATE_FLAG) and date window.
We reproduce the same logic here.
ðŸ”¹ Map SAP Date-Flag logic
Flag
Column used
L
vbap_erdat (line create)
P
pgidate
R
vbep_h_edatu
C
vbak_erdat
F
vbep_mbdat
A
vbap_aedat
N
No date filter











date_cond = (
    ( (F.lit(ip_date_flag) == 'L') & (prst_filt["vbap_erdat"].between(ip_erdat_from, ip_erdat_to)) ) |
    ( (F.lit(ip_date_flag) == 'P') & (prst_filt["pgidate"].between(ip_erdat_from, ip_erdat_to)) ) |
    ( (F.lit(ip_date_flag) == 'R') & (prst_filt["vbep_h_edatu"].between(ip_erdat_from, ip_erdat_to)) ) |
    ( (F.lit(ip_date_flag) == 'C') & (prst_filt["vbak_erdat"].between(ip_erdat_from, ip_erdat_to)) ) |
    ( (F.lit(ip_date_flag) == 'F') & (prst_filt["vbep_mbdat"].between(ip_erdat_from, ip_erdat_to)) ) |
    ( (F.lit(ip_date_flag) == 'A') & (prst_filt["vbap_aedat"].between(ip_erdat_from, ip_erdat_to)) ) |
    (F.lit(ip_date_flag) == 'N')
)

prst_run = prst_filt.filter(date_cond)
prst_run.createOrReplaceTempView("prst_run")





