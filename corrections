CELL 8 — OBPRSUPPL (IPLM Problem-Report Suppliers)
Purpose:
This step finds suppliers coming from IPLM Obsolescence Problem Reports.
It answers:
“If this part is obsolete and under investigation, which supplier is responsible?”





obpr = (
    nhalist
    .join(problem_pt, problem_pt.part_name == nhalist.nha_cd)
    .filter(
        (problem_pt.part_name != "NA") &
        (F.upper(problem_pt.state) != "CLOSED") &
        (
            F.upper(problem_pt.state).isin("CONFIRMED", "IN REVIEW", "IN WORK") |
            F.upper(problem_pt.disposition).isin("CONFIRMED", "DEFER")
        ) &
        (F.upper(problem_pt.reason) == "OBSOLETE COMPONENT")
    )
    .withColumn("suppcd_pr", F.lpad(problem_pt.supplier_code, 10, "0"))
    .join(
        lfa1.select(
            F.col("lifnr").alias("suppcd_pr"),
            F.col("name1").alias("suppname_pr")
        ),
        "suppcd_pr",
        "left"
    )
    .select(
        nhalist.nha_cd.alias("nha_cd"),
        "suppcd_pr",
        "suppname_pr"
    )
)