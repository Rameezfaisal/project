






dmd_cols = ["dmdpd"] + [f"dmd{i}" for i in range(1,27)]

sprsdmd = (
    forecast
    .join(nhalist, forecast.matnr == nhalist.nha, "inner")
    .filter(
        (forecast.rowtype == "07") &
        (forecast.werks == "COMB")
    )
    .groupBy(
        nhalist.cmpprtno.alias("cmpprtno_cd"),
        forecast.matnr.alias("nha_cd")
    )
    .agg(
        sum(F.sum(F.col(c)) for c in dmd_cols).alias("sprs_dmd")
    )
)