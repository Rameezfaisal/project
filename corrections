# ------------------------------------------------
# 1) Mark NHAs as processed
# ------------------------------------------------
spark.sql(f"""
UPDATE {tgt_nha}
SET isprocessed = 'Y'
WHERE nha IN (SELECT nha_cd FROM nha_list)
""")

# ------------------------------------------------
# 2) Compute counts for logging
# ------------------------------------------------
obprt_cnt = df_nha.select("cmpprtno_cd").distinct().count()
nha_cnt   = df_nha.select("nha_cd").distinct().count()

# ------------------------------------------------
# 3) Insert into OMAT_LOG_DTLS
# ------------------------------------------------
spark.sql(f"""
INSERT INTO {tgt_log}
(
  program_name,
  obprtno_cnt,
  obprtno_nha_cnt,
  obpr_cnt,
  executed_on
)
VALUES
(
  'sp_omat_insert_suppliers_byplant - finished',
  1,
  {obprt_cnt},
  {nha_cnt},
  current_timestamp()
)
""")