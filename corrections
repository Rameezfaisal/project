Cell 5 — Build Component Structure for Active OBPRs (SAP: DTLS_INFO)
Business purpose:
For every active OBPR part, identify its component parts, quantities, levels and material groups that form the Make-NHA hierarchy.

This dataset now represents:
“For each valid OBPR part, what components exist, at what level, in what quantity, and in what material group.”








df_dtls_info = (
    df_make_nha.alias("c")
        .join(
            df_obprtno.alias("a"),
            F.col("c.cmpprtno") == F.col("a.obprtno"),
            "inner"
        )
        .filter(F.col("a.obpr_state").isin(valid_obpr_states))
        .select(
            F.col("c.cmpprtno").alias("cmpprtno"),
            F.col("c.cmpqpa").alias("cmpqpa"),
            F.col("c.level").alias("level"),
            F.col("c.matkl").alias("matkl")
        )
        .distinct()
)

