Cell 9 â€“ LAM Quantity On Hand & Restricted Stock
What this cell does
Implements SAP 128743 change:
Calculates LAMQOH and RESTRICTED_ALL_STOCK from CV_MARD, excluding storage location V014, grouped by CMPPRTNO + NHA.






lamqoh = (
    mard
    .join(nhalist, mard.matnr == nhalist.nha, "inner")
    .filter(~mard.lgort.isin("V014"))
    .groupBy(
        nhalist.cmpprtno.alias("cmpprtno_cd"),
        mard.matnr.alias("nha_cd")
    )
    .agg(
        F.sum(mard.labst + mard.klabs).alias("lamqoh"),
        F.sum(mard.insme + mard.umlme + mard.einme + mard.speme).alias("restricted_all_stock")
    )
)