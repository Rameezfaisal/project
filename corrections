Cell 4 â€” Build cumulative committed quantity per schedule line
Business meaning:
Calculate, for every order line and schedule line, how much quantity has been committed up to that schedule, which SAP uses to decide backorders, PGIQty and OpenQty.







# keep only positive committed schedule lines
vbep_pos = (
    vbep
    .filter(F.col("bmeng") > 0)
    .select(
        F.col("vbeln").alias("vbeln_cd"),
        F.col("posnr").alias("posnr_cd"),
        F.col("etenr").alias("etenr_cd"),
        F.col("bmeng").alias("bmeng_cd")
    )
)

# cumulative committed qty per sales order line
w_sched = (
    Window
    .partitionBy("vbeln_cd", "posnr_cd")
    .orderBy("etenr_cd")
    .rowsBetween(Window.unboundedPreceding, Window.currentRow)
)

vbep_cum = (
    vbep_pos
    .withColumn("expectedqtycumulative_cd", F.sum("bmeng_cd").over(w_sched))
)

# this replaces SAP temp table "t"
vbep_cum.createOrReplaceTempView("vbep_cum")