Here is a clean, professional, first-cell Markdown you can paste at the top of your Fabric notebook.
üìò OMAT ‚Äì R,S Buy-NHA Supplier Resolution (Fabric Implementation)
1Ô∏è‚É£ Purpose of this Notebook
This notebook is the Microsoft Fabric (Spark + Delta) implementation of the SAP HANA stored procedure:
SP_OMAT_INSERT_RS_SUPPLIER
Its purpose is to identify, prioritize, and store supplier information for all R and S type NHA (Next Higher Assembly) parts used in the OMAT obsolescence program.
For every R/S NHA, it determines:
Who the best supplier is
From which business source (ML master, open PO, or IPLM problem report)
And which plant (2000) that supplier applies to
It then updates downstream OMAT reporting tables so that:
Procurement
Obsolescence
Costing
can all use a single, consistent supplier source of truth.
2Ô∏è‚É£ What This Notebook Does (End-to-End Flow)
This notebook performs the following steps:
Step
What it does
1
Identifies all R and S type NHAs from OMAT demand & details tables
2
Reads Master Supplier from GLIS (ML_PART)
3
Finds Open Purchase Order suppliers from ECC (ZPO_HSTRY, EKPO, LFA1)
4
Finds Problem Report suppliers from IPLM
5
Applies business priority rules to select the best supplier
6
Writes the resolved suppliers into a Delta table
7
Updates OMAT RSCXD details with the selected supplier
This exactly mirrors the SAP HANA logic ‚Äî but implemented in a Fabric-safe, Spark-native, Delta-compliant way.
3Ô∏è‚É£ Business Logic: How the Supplier is Chosen
For each NHA, the supplier is selected using this strict priority:
ü•á Priority 1 ‚Äì ML Master (GLIS)
If the NHA has a SupplierID in CV_ML_PART
‚Üí This is the primary supplier
ü•à Priority 2 ‚Äì Open Purchase Orders
If there are active open POs for the NHA:
First PO supplier (PO1)
Then second PO supplier (PO2)
Only valid POs are considered:
Not cancelled
Not inactive
Not stock transfer
Not delivery completed
Not year-end / April-1 placeholder dates
ü•â Priority 3 ‚Äì IPLM Obsolescence Problem Report
If the part is:
Obsolete
In confirmed / review / work state
then the IPLM supplier is used.
4Ô∏è‚É£ Final Selection Fields Created
For every NHA, the notebook derives:
Column
Meaning
omat_selected_plant
Plant where the selected supplier applies (always 2000)
omat_selected_suppliercd
Final chosen supplier code
omat_selected_supplier
Final chosen supplier name
suppcd_po1
First open PO supplier
suppcd_po2
Second open PO supplier
suppcd_pr
IPLM problem report supplier
5Ô∏è‚É£ Target Tables This Notebook Populates
üìå 1. eng_test.rpt_omat_buynha_suppliers_plants
This is the core supplier resolution table.
It stores, per NHA, all supplier sources and the final OMAT decision.
It acts as the single source of truth for:
Which supplier OMAT should use
From which source (ML / PO / PR)
For which plant
It contains:
Supplier codes for each plant (1900, 2000, 3120, etc.)
Open PO suppliers
Problem report suppliers
Final OMAT-selected supplier
This replaces SAP table:
ZT_OMAT_BUYNHA_SUPPLIERS_PLANTS
üìå 2. eng_test.rpt_omat_rscxd_dtls
This is the operational OMAT reporting table used by:
Buyers
Engineers
Obsolescence teams
This notebook updates it so that for every R/S NHA:
Column
What gets filled
vencode
Final OMAT selected supplier code
venname
Final OMAT selected supplier name
po_supplier_code
First open PO supplier
po_supplier
First open PO supplier name
This ensures that OMAT dashboards and reports always show the correct supplier.
6Ô∏è‚É£ Why This Matters
This notebook ensures that:
R & S parts always have a valid buy supplier
Buyers don‚Äôt chase wrong vendors
Obsolete parts are still traceable to accountable suppliers
OMAT data is consistent across ECC, IPLM, and GLIS
It is a mission-critical data product for:
Procurement + Obsolescence + Supply Chain Analytics
If you want, next I can also give you:
A data-flow diagram
Or a column-level lineage table for interviews or design reviews.